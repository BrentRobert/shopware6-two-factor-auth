(this.webpackJsonp=this.webpackJsonp||[]).push([["rune-laenen-two-factor-auth"],{"FOj+":function(e,t){e.exports='\n{% block sw_setting_user_detail_card_integrations %}\n    <sw-card :title="$tc(\'rl-2fa.settings.user-detail.title\')"\n             :is-loading="isLoading || isLoading2Fa">\n        <div v-if="user && user.customFields && user.customFields.rl_2fa_secret">\n\n            <sw-alert variant="success"\n                      title="Two factor authentication is enabled"\n                      style="margin-bottom: 0;"\n                      :showIcon="true"\n                      :closable="false">\n                Congrats! You\'re secure!<br />\n                To disable 2FA for your account, click the button below.\n\n                <template v-slot:actions>\n                    <sw-button @click="disable2FA">Disable 2FA</sw-button>\n                </template>\n            </sw-alert>\n        </div>\n        <div v-else-if="!generatedSecretUrl">\n            <sw-alert variant="warning"\n                      title="Two factor authentication is not enabled"\n                      style="margin-bottom: 0;"\n                      :showIcon="true"\n                      :closable="false">\n                Two factor authentication is not enabled for your account. Click the button below to set it up.\n\n                <template v-slot:actions>\n                    <sw-button @click="generateSecret">Click me to get started</sw-button>\n                </template>\n            </sw-alert>\n        </div>\n        <div v-else-if="generatedSecretUrl">\n            <sw-container columns="1fr 1fr">\n                <div>\n                    <img :src="generatedSecretUrl" />\n                </div>\n                <div>\n                    <b>Scan the code on the left with your 2FA app.</b><br />\n                    <br />\n                    Fill in your One Time Password and click \'Validate & enable\' to check the code and enable 2FA for\n                    your admin account.<br />\n                    <br />\n                    <sw-alert variant="error"\n                              title="Something went wrong"\n                              :showIcon="true"\n                              v-if="oneTimePasswordError.length > 0">\n                        {{ oneTimePasswordError }}\n                    </sw-alert>\n\n                    <sw-text-field label="One-time Password"\n                                   :isInvalid="oneTimePasswordError.length > 0"\n                                   v-model="oneTimePassword"></sw-text-field>\n\n                    <sw-button @click="validateAndSaveOneTimePassword">\n                        Validate & Save\n                    </sw-button>\n                </div>\n            </sw-container>\n        </div>\n    </sw-card>\n\n    {% parent %}\n{% endblock %}\n'},QO4r:function(e,t,n){"use strict";n.r(t);var s=n("nOez"),i=n.n(s);const{Component:r,Context:o,Application:a}=Shopware;r.override("sw-login-login",{template:i.a,data:()=>({rememberOtpPassword:"",showOtpForm:!1,otp:""}),methods:{loginUserWithPasswordAndOtp(){return this.$emit("is-loading"),this.loginWithOtp(this.username,this.password,this.otp).then(()=>{this.handleLoginSuccess(),this.$emit("is-not-loading")}).catch(e=>{this.password="",this.showOtpForm=!1,this.handleLoginError(e),this.$emit("is-not-loading")})},loginWithOtp(e,t,n){return a.getContainer("init").httpClient.post("/oauth/token",{grant_type:"password",client_id:"administration",scopes:"write",username:e,password:t,rl_2fa_otp:n},{baseURL:o.api.apiPath}).then(e=>{const t=this.loginService.setBearerAuthentication({access:e.data.access_token,refresh:e.data.refresh_token,expiry:e.data.expires_in});return window.localStorage.setItem("redirectFromLogin","true"),t})},loginUserWithPassword(){this.rememberOtpPassword=this.password,this.$super("loginUserWithPassword")},handleLoginError(e){if("request-otp"!==e.response.data.errors[0].detail)return this.$super("handleLoginError",e);this.password=this.rememberOtpPassword,this.showOtpForm=!0}}});var l=n("FOj+"),d=n.n(l);const{Component:c,ApiService:h}=Shopware;c.override("sw-settings-user-detail",{template:d.a,data:()=>({httpClient:null,isLoading2Fa:!1,generatedSecret:null,generatedSecretUrl:null,oneTimePassword:"",oneTimePasswordError:""}),created(){this.syncService=Shopware.Service("syncService"),this.httpClient=this.syncService.httpClient},methods:{generateSecret(){this.isLoading2Fa=!0,this.httpClient.get("rl-2fa/generate-secret",{params:{holder:this.user.username}}).then(e=>{this.isLoading2Fa=!1,this.generatedSecret=e.data.secret,this.generatedSecretUrl=e.data.qrUrl})},validateAndSaveOneTimePassword(){this.isLoading2Fa=!0,this.httpClient.post("rl-2fa/validate-secret",{secret:this.generatedSecret,code:this.oneTimePassword}).then(e=>{this.isLoading2Fa=!1,"OK"!==e.data.status?this.oneTimePasswordError=error.response.data.error:this.saveOneTimePassword()})},saveOneTimePassword(){this.user.customFields||this.$set(this.user,"customFields",{}),this.user.customFields.rl_2fa_secret=this.generatedSecret,this.onSave()},disable2FA(){this.user.customFields||this.$set(this.user,"customFields",{}),this.user.customFields.rl_2fa_secret="",this.onSave()}}})},nOez:function(e,t){e.exports='{% block sw_login_login %}\n\n    <div v-if="!showOtpForm">\n        {% parent %}\n    </div>\n    <div v-else>\n        <form class="sw-login-login sw-login-login-otp" @submit.prevent="loginUserWithPasswordAndOtp">\n            <h2 class="sw-login__content-headline">{{ $tc(\'sw-login.index.headlineForm\') }}</h2>\n\n            <sw-text-field\n                v-autofocus\n                v-model="otp"\n                :label="$tc(\'rl-2fa.sw-login.index.labelOtp\')"\n                required>\n            </sw-text-field>\n\n            <div class="sw-login__submit">\n                <sw-button :disabled="otp.length != 6 || password.length <= 0 || username.length <= 0"\n                           class="sw-login__login-action"\n                           variant="primary">\n                    {{ $tc(\'sw-login.index.buttonLogin\') }}\n                </sw-button>\n            </div>\n        </form>\n    </div>\n{% endblock %}\n'}},[["QO4r","runtime"]]]);